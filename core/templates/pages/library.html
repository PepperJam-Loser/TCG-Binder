<!--Will use this late for search...
    This is a valid api search for a name: https://api.scryfall.com/cards/search?order=name&q=name:giant&unique=cards&format=json
    https://api.scryfall.com/cards/search?order=name&q=name:%{Create a name variable}&unique=cards&format=json-->

<!DOCTYPE html>
{% extends 'main.html' %}
{% load static %}
{% block layout %}

<div class="flex flex-col items-center mx-10 md:mx-20">
    <h1 class="prose-2xl mb-4">Library</h1>

    <!-- Search Bar -->
    <form method="GET" action="{% url 'library' %}" class="mb-4">
        <input type="text" name="q" placeholder="Search for cards" class="input input-bordered w-full max-w-md" />
        <button type="submit" class="btn">Search</button>
    </form>

    <!-- Display Search Results -->
    {% if search_results %}
    <div class="grid grid-cols-6 gap-4">
        {% for card in search_results %}
        <div class="card">
            <div class="card-img">
                <img src="{{ card.img_png }}" alt="{{ card.cardName }}" class="scaled_image">
            </div>
            <div class="card-details">
                <!-- Form to add the card to collection -->
                <form method="POST" action="{% url 'add_card_to_collection' card.id %}">
                    {% csrf_token %}
                    <input type="hidden" name="card_id" value="{{card.id}}">
                    <button type="submit" class="btn">Add to Collection</button>
                </form>
                <!-- Add more card details as needed -->
                <a href="{% url 'card_details' card.id %}" class="btn btn-primary">Show Details</a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>

<div class="flex flex-col px-40">
    <div id="output"></div>
</div>

<script>
    // AJAX request for searching cards
    document.getElementById("search-form").addEventListener("submit", function (event) {
        event.preventDefault(); // Prevent default form submission
        const query = document.getElementById("search-input").value;
        fetch(`/search/?q=${query}`)
            .then(response => response.json())
            .then(data => {
                const searchResults = document.getElementById("search-results");
                searchResults.innerHTML = ""; // Clear previous search results
                data.cards.forEach(card => {
                    const cardElement = document.createElement("div");
                    cardElement.textContent = card.cardName;
                    // Add more card details as needed
                    searchResults.appendChild(cardElement);
                });
            })
            .catch(error => {
                console.error("Error fetching search results:", error);
            });
    });
</script>


<style>
    .flip-card {
        width: 300px;
        height: 400px;
        font-family: sans-serif;
        border-radius: 1rem;
        overflow-y: scroll;
        border: 1px solid transparent;
    }

    .title {
        font-size: 1.5em;
        font-weight: 900;
        text-align: center;
        margin: 0;
    }

    .flip-card-inner {
        position: relative;
        width: 100%;
        height: 100%;
        text-align: center;
        transition: transform 0.8s;
        transform-style: preserve-3d;
        background-color: grey;
    }

    .flip-card.clicked .flip-card-inner {
        transform: rotateY(180deg);
    }

    .flip-card-front, .flip-card-back {
        box-shadow: 0 8px 14px 0 rgba(0,0,0,0.2);
        position: absolute;
        display: flex;
        flex-direction: column;
        justify-content: center;
        width: 100%;
        height: 100%;
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        border: 1px solid rgb(0, 0, 0);
        border-radius: 1rem;
        background-color: grey;
    }

    .flip-card-front {
        color: rgb(0, 0, 0);
    }

    .flip-card-back {
        color: rgb(0, 0, 0);
        transform: rotateY(180deg);
    }

    .flip-card.clicked .flip-card-front {
        visibility: hidden;
    }

    .flip-card.clicked .flip-card-back {
        visibility: visible;
    }


    .flip-card:hover {
        outline: 2px solid white;
    }

    .card {
        position: relative;
    }

    .card-details {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.8); /* semi-transparent background */
        color: white;
        padding: 10px;
    }

    .card:hover .card-details {
        display: block; /* Show card details when card is hovered */
    }

    .scaled_image {
        width: 100%;
        height: auto;
    }
</style>
{% endblock %}
